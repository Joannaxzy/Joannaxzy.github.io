View(df_hosp)
View(df_hosp)
View(f2)
manual <- f2 %>% select(hosp_cpt_manual,img_cpt_manual,pro_cpt_manual)
View(manual)
manual <- f2 %>% select(id_list,hosp_cpt_manual,img_cpt_manual,pro_cpt_manual)
View(manual)
dat.long <- reshape(manual, idvar = "id_list",
varying = list(c(2,3,4)),
v.names = "lead", times=c(0,1,4,6),
direction = "long")
dat.long <- reshape(manual, idvar = "id_list",
varying = list(c(2,3,4)),
v.names = "lead", times=c(0,1,4),
direction = "long")
View(dat.long)
dat.long <- reshape(manual, idvar = "id_list",
varying = list(c(3,4,5)),
v.names = "lead", times=c(0,1,4),
direction = "long")
dat.long <- reshape(manual, idvar = "id_list",
varying = list(c(3,4,5)),
v.names = "lead", times=c(0,1,2),
direction = "long")
dat <- read.csv("/Users/ziyuxiao/Desktop/UW/Spring2020/BIOST540/Dataset/tlc.csv", header=TRUE)[,-1]
head(dat)
## - EDA data (wide form)
## - check out the data first
## -- summary descriptives
by(dat[,-c(1,2)], INDICES = dat$tx, FUN=summary)
## -- correlation
by(dat[,-c(1,2)], INDICES = dat$tx, FUN=cor)
## -- extract mean -- this gives you a list
meanprofile <- by(dat[,-c(1,2)], INDICES = dat$tx, FUN=colMeans)
##Lab1是用long table去画mean
## -- times of observations
times <- c(0, 1, 4, 6)
## -- plot mean profile
plot(times, meanprofile[[1]], type='l', col='blue', xlab="Weeks", ylab="Blood Lead Level")
lines(times, meanprofile[[2]], col='red')
legend('topright', c("A", "P"), col=c("blue", "red"), lty=1)
View(dat)
dat.long <- reshape(dat, idvar = "id",
varying = list(c(3,4,5,6)),
v.names = "lead", times=c(0,1,4,6),
direction = "long")
View(dat.long)
manual %>%
pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manuall", values_to = "population")
unite <- function(x){
if (1 %in% x) {
x[x==0] <- 1
}
return(x)
f1 <- full_join(df_hosp,df_img,by="id_list")
f2 <- full_join(f1,df_pro,by="id_list")
manual <- f2 %>% select(id_list,hosp_cpt_manual,img_cpt_manual,pro_cpt_manual)
percu <- f2 %>% select(id_list,hosp_cpt_percu,img_cpt_percu,pro_cpt_percu)
image <- f2 %>% select(id_list,hosp_cpt_image,img_cpt_image,pro_cpt_image)
surg <- f2 %>% select(id_list,hosp_cpt_surg,img_cpt_surg,pro_cpt_surg)
manual <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value")
f1 <- full_join(df_hosp,df_img,by="id_list")
f2 <- full_join(f1,df_pro,by="id_list")
manual <- f2 %>% select(id_list,hosp_cpt_manual,img_cpt_manual,pro_cpt_manual)
percu <- f2 %>% select(id_list,hosp_cpt_percu,img_cpt_percu,pro_cpt_percu)
image <- f2 %>% select(id_list,hosp_cpt_image,img_cpt_image,pro_cpt_image)
surg <- f2 %>% select(id_list,hosp_cpt_surg,img_cpt_surg,pro_cpt_surg)
## Reshape the data into long form
manual <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value")
percu <- percu %>% pivot_longer(c('hosp_cpt_percu','img_cpt_percu','pro_cpt_percu'), names_to = "percu", values_to = "value")
image <- image %>% pivot_longer(c('hosp_cpt_image','img_cpt_image','pro_cpt_image'), names_to = "image", values_to = "value")
surg <- surg %>% pivot_longer(c('hosp_cpt_surg','img_cpt_surg','pro_cpt_surg'), names_to = "surg", values_to = "value")
f1 <- full_join(df_hosp,df_img,by="id_list")
f2 <- full_join(f1,df_pro,by="id_list")
manual <- f2 %>% select(id_list,hosp_cpt_manual,img_cpt_manual,pro_cpt_manual)
percu <- f2 %>% select(id_list,hosp_cpt_percu,img_cpt_percu,pro_cpt_percu)
image <- f2 %>% select(id_list,hosp_cpt_image,img_cpt_image,pro_cpt_image)
surg <- f2 %>% select(id_list,hosp_cpt_surg,img_cpt_surg,pro_cpt_surg)
## Reshape the data into long form
manual <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value")
percu <- percu %>% pivot_longer(c('hosp_cpt_percu','img_cpt_percu','pro_cpt_percu'), names_to = "percu", values_to = "value")
image <- image %>% pivot_longer(c('hosp_cpt_image','img_cpt_image','pro_cpt_image'), names_to = "image", values_to = "value")
surg <- surg %>% pivot_longer(c('hosp_cpt_surg','img_cpt_surg','pro_cpt_surg'), names_to = "surg", values_to = "value")
View(surg)
f1 <- full_join(df_hosp,df_img,by="id_list")
f2 <- full_join(f1,df_pro,by="id_list")
manual <- f2 %>% select(id_list,hosp_cpt_manual,img_cpt_manual,pro_cpt_manual)
percu <- f2 %>% select(id_list,hosp_cpt_percu,img_cpt_percu,pro_cpt_percu)
image <- f2 %>% select(id_list,hosp_cpt_image,img_cpt_image,pro_cpt_image)
surg <- f2 %>% select(id_list,hosp_cpt_surg,img_cpt_surg,pro_cpt_surg)
## Reshape the data into long form
manual <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value")
percu <- percu %>% pivot_longer(c('hosp_cpt_percu','img_cpt_percu','pro_cpt_percu'), names_to = "percu", values_to = "value")
image <- image %>% pivot_longer(c('hosp_cpt_image','img_cpt_image','pro_cpt_image'), names_to = "image", values_to = "value")
surg <- surg %>% pivot_longer(c('hosp_cpt_surg','img_cpt_surg','pro_cpt_surg'), names_to = "surg", values_to = "value")
unite <- function(x){
if (1 %in% x) {
x[x==0] <- 1
}
return(x)
}
# run function in the 4 variables and choose the first row of each patient
manual_final <- manual %>% group_by(id_list) %>%
mutate(manual=unite(manual)) %>%
filter(row_number()==1)
View(manual_final)
View(manual)
manual_final <- manual %>% group_by(id_list) %>% filter(value==1)
View(manual_final)
View(manual_final)
manual <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>% group_by(id_list) %>% arrange(value)
manual <- f2 %>% select(id_list,hosp_cpt_manual,img_cpt_manual,pro_cpt_manual)
## Reshape the data into long form
manual <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>% group_by(id_list) %>% arrange(value)
View(manual)
manual <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>% group_by(id_list) %>% arrange(id_list,value)
manual <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>% arrange(id_list,value)
manual%>%arrange(value)
manual%>%arrange(desc(value),by_group=TRUE)
manual%>%arrange(desc(value),.by_group=TRUE)
manual <- f2 %>% select(id_list,hosp_cpt_manual,img_cpt_manual,pro_cpt_manual)
manual <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>% group_by(id_list) %>% arrange(desc(value),.by_group=TRUE)
View(manual)
manual <- f2 %>% select(id_list,hosp_cpt_manual,img_cpt_manual,pro_cpt_manual)
View(manual)
manual <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>% group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)
View(manual)
f1 <- full_join(df_hosp,df_img,by="id_list")
f2 <- full_join(f1,df_pro,by="id_list")
manual <- f2 %>% select(id_list,hosp_cpt_manual,img_cpt_manual,pro_cpt_manual)
percu <- f2 %>% select(id_list,hosp_cpt_percu,img_cpt_percu,pro_cpt_percu)
image <- f2 %>% select(id_list,hosp_cpt_image,img_cpt_image,pro_cpt_image)
surg <- f2 %>% select(id_list,hosp_cpt_surg,img_cpt_surg,pro_cpt_surg)
## Reshape the data into long form
manual <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)
percu <- percu %>% pivot_longer(c('hosp_cpt_percu','img_cpt_percu','pro_cpt_percu'), names_to = "percu", values_to = "value") %>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)
image <- image %>% pivot_longer(c('hosp_cpt_image','img_cpt_image','pro_cpt_image'), names_to = "image", values_to = "value")%>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)
surg <- surg %>% pivot_longer(c('hosp_cpt_surg','img_cpt_surg','pro_cpt_surg'), names_to = "surg", values_to = "value")%>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)
f1 <- full_join(df_hosp,df_img,by="id_list")
f2 <- full_join(f1,df_pro,by="id_list")
manual <- f2 %>% select(id_list,hosp_cpt_manual,img_cpt_manual,pro_cpt_manual)
percu <- f2 %>% select(id_list,hosp_cpt_percu,img_cpt_percu,pro_cpt_percu)
image <- f2 %>% select(id_list,hosp_cpt_image,img_cpt_image,pro_cpt_image)
surg <- f2 %>% select(id_list,hosp_cpt_surg,img_cpt_surg,pro_cpt_surg)
## Reshape the data into long form
manual_new <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)
percu_new <- percu %>% pivot_longer(c('hosp_cpt_percu','img_cpt_percu','pro_cpt_percu'), names_to = "percu", values_to = "value") %>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)
image_new <- image %>% pivot_longer(c('hosp_cpt_image','img_cpt_image','pro_cpt_image'), names_to = "image", values_to = "value")%>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)
surg_new <- surg %>% pivot_longer(c('hosp_cpt_surg','img_cpt_surg','pro_cpt_surg'), names_to = "surg", values_to = "value")%>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)
View(manual_new)
manual_new <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1) %>% rename(value= manual)
manual_new <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1) %>% select(id_list,value) %>% rename(manual=value)
View(manual_new)
f1 <- full_join(df_hosp,df_img,by="id_list")
f2 <- full_join(f1,df_pro,by="id_list")
manual <- f2 %>% select(id_list,hosp_cpt_manual,img_cpt_manual,pro_cpt_manual)
percu <- f2 %>% select(id_list,hosp_cpt_percu,img_cpt_percu,pro_cpt_percu)
image <- f2 %>% select(id_list,hosp_cpt_image,img_cpt_image,pro_cpt_image)
surg <- f2 %>% select(id_list,hosp_cpt_surg,img_cpt_surg,pro_cpt_surg)
## Reshape the data into long form
manual_new <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1) %>% select(id_list,value) %>% rename(manual=value)
percu_new <- percu %>% pivot_longer(c('hosp_cpt_percu','img_cpt_percu','pro_cpt_percu'), names_to = "percu", values_to = "value") %>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)%>% select(id_list,value) %>% rename(percut=value)
image_new <- image %>% pivot_longer(c('hosp_cpt_image','img_cpt_image','pro_cpt_image'), names_to = "image", values_to = "value")%>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)%>% select(id_list,value) %>% rename(spineimage=value)
surg_new <- surg %>% pivot_longer(c('hosp_cpt_surg','img_cpt_surg','pro_cpt_surg'), names_to = "surg", values_to = "value")%>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)%>% select(id_list,value) %>% rename(spinesurg=value)
View(surg_new)
View(image_new)
View(image_new)
View(surg_new)
surg_new <- surg %>% pivot_longer(c('hosp_cpt_surg','img_cpt_surg','pro_cpt_surg'), names_to = "surg", values_to = "value")%>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE)
View(surg_new)
f1 <- full_join(df_hosp,df_img,by="id_list")
f2 <- full_join(f1,df_pro,by="id_list")
manual <- f2 %>% select(id_list,hosp_cpt_manual,img_cpt_manual,pro_cpt_manual)
percu <- f2 %>% select(id_list,hosp_cpt_percu,img_cpt_percu,pro_cpt_percu)
image <- f2 %>% select(id_list,hosp_cpt_image,img_cpt_image,pro_cpt_image)
surg <- f2 %>% select(id_list,hosp_cpt_surg,img_cpt_surg,pro_cpt_surg)
## Reshape the data into long form
manual_new <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1) %>% select(id_list,value) %>% rename(manual=value)
percu_new <- percu %>% pivot_longer(c('hosp_cpt_percu','img_cpt_percu','pro_cpt_percu'), names_to = "percu", values_to = "value") %>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)%>% select(id_list,value) %>% rename(percut=value)
image_new <- image %>% pivot_longer(c('hosp_cpt_image','img_cpt_image','pro_cpt_image'), names_to = "image", values_to = "value")%>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)%>% select(id_list,value) %>% rename(spineimage=value)
surg_new <- surg %>% pivot_longer(c('hosp_cpt_surg','img_cpt_surg','pro_cpt_surg'), names_to = "surg", values_to = "value")%>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)%>% select(id_list,value) %>% rename(spinesurg=value)
library(tidyverse)
EHR_index <- read.csv("/Users/ziyuxiao/Desktop/UW/Fall2020/BIOST596/data/LESS data capstone/EMR data/LESS_EMRDATA_IndexVisit.csv",header = TRUE)
EHR_hosp <- read.csv("/Users/ziyuxiao/Desktop/UW/Fall2020/BIOST596/data/LESS data capstone/EMR data/LESS_EMRDATA_Hospitalizations.csv", header = TRUE)
# EHR_hosp$hospitalization_proccode has cpt code
EHR_img <- read.csv("/Users/ziyuxiao/Desktop/UW/Fall2020/BIOST596/data/LESS data capstone/EMR data/LESS_EMRDATA_Image.csv", header = TRUE)
# EHR_img$image_cod has cpt code
EHR_pro <- read.csv("/Users/ziyuxiao/Desktop/UW/Fall2020/BIOST596/data/LESS data capstone/EMR data/LESS_EMRDATA_Procedures.csv", header = TRUE)
id_list <- unique(EHR_index$crosswalk_id)
df_index <- data.frame(id_list)
df_index$dxcat <- 0
for (i in 1:nrow(EHR_index)){
j <-  match(EHR_index$crosswalk_id[i], df_index$id_list)
if ( EHR_index[i, 'index_primaryicd9'] %in% c(721.3, 721.9, 722.5,
722.51, 722.52, 722.6, 724.2, 724.5, 724.6, 739.4, 846.0, 847.2, 847.3, 847.9)) {
df_index[j, 'dxcat'] = 0
} else if (EHR_index[i, 'index_primaryicd9'] %in% c(722.1, 722.10, 722.2, 724.3, 724.4)) {
df_index[j, 'dxcat'] = 1
} else if (EHR_index[i, 'index_primaryicd9'] %in% c(724.00, 724.0, 724.01, 724.02, 724.03)) {
df_index[j, 'dxcat'] = 2
} else {
df_index[j, 'dxcat'] = 3
}
}
View(df_index)
#manual
manual_cpt <- '97110 97112 97113 97124 97140 97116 97530 97001 97002 97003 97004 97005 97006 97010 97012 97014 97016 97018 97022 97024 97026 97028 97032 97033 97034 97035 97036 97039 97139 97150 98940 98941 98942 98943 97810 97811 97813 97814 98925 98926 98927 98928 98929 97124 99201 99202 99203 99204 99205 99211 99212 99213 99214 99215 99241 99242 99243 99244 99245 99429 99354 99355 99356 99357 99385 99386 99387 99395 99396 99397 99401 99402 99403 99404 99455 99456 99499 99217 99218 99219 99220 99411 99412 99420 99281 99282 99283 99284 99285 99341 99342 99343 99344 99345 99347 99348 99349 99350 22305 22310 22315 20661 20664'
manual_list<- strsplit(manual_cpt, " ")
manual_list<- matrix(unlist(manual_list))
##percutaneous
percu_cpt <- '64475 62272 62311 62318 62319 64476 64479 64480 64483 64484 62282 62311 27096  64447 64425 64420 64421 64505 64530 62273 64530 62272  20552 20553 20610 J0585 62280 62281 62294 62310 62292 62287 62289 62298 64442 62274 62275 62278 62288 64520 64494 64491 64495 64493 64620 64622 64623 64640 64680 64681 22526 22527 95991 62350 62355 62365 62351 62362 62368 62360 62361 62367 11981 11982 11983 95970 95971 95972 63650 63655 64555 64575 63685 64590 63688 64585 64595 63660 22520 22521 22522 22523 22524 22525'
percu_list <- strsplit(percu_cpt, " ")
percu_list<- matrix(unlist(percu_list))
## image cpt
image_cpt <- '72200 72202 72220 72010 72020 72040 72050 72052 72069 72070 72072 72074 72080 72090 72100 72110 72114 72120 72141 72142 72146 72147 72148 72149 72156 72157 72158 72125 72126 72127 72128 72129 72130 72131 72132 72133 72295 72285 62290 62291 77003'
image_list <- strsplit(image_cpt, " ")
image_list<- matrix(unlist(image_list))
#surgical
surg_cpt <- '63010 63075 63076 63077 63078 63055 63056 63057 63064 63066 63001 63003 63005 63011 63012 63030 63035 63042 63044 63017 63047 63048 63015 63016 63020 63040 63043 63045 63046 63050 63051 63172 63173 63182 63185 63191 63194 63195 63196 63197 63198 63199 63170 63180 63200 63250 63251 63252 63265 63266 63267 63268 63270 63271 63272 63273 63295 63170 63190 63275 63278 63280 63281 63282 63283 63285 63287 63290 63295 63012 63185 63200 63267 63272 20930 20931 20936 20937 20938 22558 22585 22612 22614 22630 22830 22840 22841 22842 22843 22844 22845 22846 22847 22849 22851 22625 22650 20930 20931 20937 20938 22585 22614 22632 22532 22533 22534 22548 22554 22556 22590 22595 22600 22610 22800 22802 22804 22808 22810 22812 22848 22850 22852 22855 22633 22856 22857 0092T 0163T 22864 22865 0095T 0164T 22861 22862 0098T 0165T 22318 22319 22325 22326 22327 22328 22325 22318 22319 22325 22326 22327 22328 63081 63082 63085 63086 63087 63088 63090 63091 63101 63102 63103 63300 63301 63302 63303 63304 63305 63306 63307 63308 22206 22207 22208 22210 22212 22214 22216 22220 22222 22224 22226 22818 22819 0171T 0172T 22850 22852 22855 63709 63600 63610 63615 63700 63702 63704 63706 63707 63709 63710 22899 64714 22010 22015 20670 20680 20900 22830 63709 22526 22527'
surg_list<- strsplit(surg_cpt, " ")
surg_list<- matrix(unlist(surg_list))
sub_hosp <- EHR_hosp %>% filter(hospitalization_procday %in% -365:0)
id_list <- unique(sub_hosp$crosswalk_id)
df_hosp <- data.frame(id_list)
df_hosp$hosp_cpt_manual <- 0
df_hosp$hosp_cpt_percu <- 0
df_hosp$hosp_cpt_image <- 0
df_hosp$hosp_cpt_surg <- 0
for (i in 1:nrow(sub_hosp)){
j = match(sub_hosp$crosswalk_id[i], df_hosp$id_list)
if (sub_hosp[i, 'hospitalization_proccode'] %in% manual_list){
df_hosp[j, 'hosp_cpt_manual'] = 1
next
}
if (sub_hosp[i, 'hospitalization_proccode'] %in% percu_list){
df_hosp[j, 'hosp_cpt_percu'] = 1
next
}
if (sub_hosp[i, 'hospitalization_proccode'] %in% image_list){
df_hosp[j, 'hosp_cpt_image'] = 1
next
}
if (sub_hosp[i, 'hospitalization_proccode'] %in% surg_list){
df_hosp[j, 'hosp_cpt_surg'] = 1
next
}
}
sub_img <- EHR_img %>% filter(image_day %in% -365:0)
id_list <- unique(sub_img$crosswalk_id)
df_img <- data.frame(id_list)
df_img$img_cpt_manual <- 0
df_img$img_cpt_percu <- 0
df_img$img_cpt_image <- 0
df_img$img_cpt_surg <- 0
##cpt
for (i in 1:nrow(sub_img)){
j = match(sub_img$crosswalk_id[i], df_img$id_list)
if (sub_img[i, 'image_code'] %in% manual_list){
df_img[j, 'img_cpt_manual'] = 1
next
}
if (sub_img[i, 'image_code'] %in% percu_list){
df_img[j, 'img_cpt_percu'] = 1
next
}
if (sub_img[i, 'image_code'] %in% image_list){
df_img[j, 'img_cpt_image'] = 1
next
}
if(sub_img[i, 'image_code'] %in% surg_list){
df_img[j, 'img_cpt_surg'] = 1
next
}
}
sub_pro <- EHR_pro %>% filter(proc_day %in% -365:0)
id_list <- unique(sub_pro$crosswalk_id)
df_pro <- data.frame(id_list)
df_pro$pro_cpt_manual <- 0
df_pro$pro_cpt_percu <- 0
df_pro$pro_cpt_image <- 0
df_pro$pro_cpt_surg <- 0
df_pro
##cpt
for (i in 1:nrow(sub_pro)){
j = match(sub_pro$crosswalk_id[i], df_pro$id_list)
if (sub_pro[i, 'proc_code'] %in% manual_list){
df_pro[j, 'pro_cpt_manual'] = 1
next
}
if (sub_pro[i, 'proc_code'] %in% percu_list)
{
df_pro[j, 'pro_cpt_percu'] = 1
next
}
if (sub_pro[i, 'proc_code'] %in% image_list){
df_pro[j, 'pro_cpt_image'] = 1
next
}
if(sub_pro[i, 'proc_code'] %in% surg_list){
df_pro[j, 'pro_cpt_surg'] = 1
next
}
}
f1 <- full_join(df_hosp,df_img,by="id_list")
f2 <- full_join(f1,df_pro,by="id_list")
View(f2)
manual <- f2 %>% select(id_list,hosp_cpt_manual,img_cpt_manual,pro_cpt_manual)
percu <- f2 %>% select(id_list,hosp_cpt_percu,img_cpt_percu,pro_cpt_percu)
image <- f2 %>% select(id_list,hosp_cpt_image,img_cpt_image,pro_cpt_image)
surg <- f2 %>% select(id_list,hosp_cpt_surg,img_cpt_surg,pro_cpt_surg)
manual_new <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1) %>% select(id_list,value) %>% rename(manual=value)
manual <- f2 %>% select(id_list,hosp_cpt_manual,img_cpt_manual,pro_cpt_manual)
manual[is.na(manual)] <- 0
View(manual)
manual_new <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1) %>% select(id_list,value) %>% rename(manual=value)
View(manual_new)
manual_new <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>%
group_by(id_list)
View(manual_new)
manual_new <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE)
View(manual_new)
f1 <- full_join(df_hosp,df_img,by="id_list")
f2 <- full_join(f1,df_pro,by="id_list")
manual <- f2 %>% select(id_list,hosp_cpt_manual,img_cpt_manual,pro_cpt_manual)
percu <- f2 %>% select(id_list,hosp_cpt_percu,img_cpt_percu,pro_cpt_percu)
image <- f2 %>% select(id_list,hosp_cpt_image,img_cpt_image,pro_cpt_image)
surg <- f2 %>% select(id_list,hosp_cpt_surg,img_cpt_surg,pro_cpt_surg)
## replace na with 0
manual[is.na(manual)] <- 0
percu[is.na(percu)] <- 0
image[is.na(image)] <- 0
surg[is.na(surg)] <- 0
## Reshape the data into long form and set 4 cpt codes for each observation
manual_new <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1) %>% select(id_list,value) %>% rename(manual=value)
percu_new <- percu %>% pivot_longer(c('hosp_cpt_percu','img_cpt_percu','pro_cpt_percu'), names_to = "percu", values_to = "value") %>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)%>% select(id_list,value) %>% rename(percut=value)
image_new <- image %>% pivot_longer(c('hosp_cpt_image','img_cpt_image','pro_cpt_image'), names_to = "image", values_to = "value")%>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)%>% select(id_list,value) %>% rename(spineimage=value)
surg_new <- surg %>% pivot_longer(c('hosp_cpt_surg','img_cpt_surg','pro_cpt_surg'), names_to = "surg", values_to = "value")%>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1)%>% select(id_list,value) %>% rename(spinesurg=value)
colnames(df_index)[1] <- "crosswalk_id"
colnames(percu_new)[1] <- "crosswalk_id"
colnames(image_new)[1] <- "crosswalk_id"
colnames(surg_new)[1] <- "crosswalk_id"
colnames(less_com)[1] <- "crosswalk_id"
colnames(df_index)[1] <- "crosswalk_id"
colnames(percu_new)[1] <- "crosswalk_id"
colnames(image_new)[1] <- "crosswalk_id"
colnames(surg_new)[1] <- "crosswalk_id"
head(percu_new,5)
head(image_new,5)
head(surg_new,5)
manual_new <-  manual%>% pivot_longer(c('hosp_cpt_manual','img_cpt_manual','pro_cpt_manual'), names_to = "manual", values_to = "value") %>%
group_by(id_list) %>% arrange(desc(value),.by_group=TRUE) %>% filter(row_number()==1) %>% select(id_list,value) %>% rename(manual=value)
View(df_hosp)
View(df_img)
View(df_index)
View(df_hosp)
View(df_img)
setwd("~/")
setwd("~/Documents/GitHub/Joannaxzy.github.io")
blogdown:::serve_site()
install.packages(c("SpatialEpi", "spdep"))
download.file("http://faculty.washington.edu/jonno/SISMIDmaterial/wacounty.dbf",
destfile = "R-examples/wacounty.dbf")
download.file("http://faculty.washington.edu/jonno/SISMIDmaterial/wacounty.shp",destfile = "R-examples/wacounty.shp")
download.file("http://faculty.washington.edu/jonno/SISMIDmaterial/wacounty.shx",destfile = "R-examples/wacounty.shx")
# Now read all the files into a single data frame
wacounty <- rgdal::readOGR(dsn="R-examples",layer="wacounty")
class(wacounty)
download.file("http://faculty.washington.edu/jonno/SISMIDmaterial/wacounty.dbf",
destfile = "R-examples/wacounty.dbf")
library(maps)
library(maptools)
install.packages("INLA")
install.packages("INLA",
repos=c(getOption("repos"),
INLA="https://inla.r-inla-download.org/R/stable"))
download.file("http://faculty.washington.edu/jonno/SISMIDmaterial/wacounty.dbf",
destfile = "R-examples/wacounty.dbf")
download.file("http://faculty.washington.edu/jonno/SISMIDmaterial/wacounty.dbf",
destfile = "wacounty.dbf")
download.file("http://faculty.washington.edu/jonno/SISMIDmaterial/wacounty.shp",destfile = "wacounty.shp")
download.file("http://faculty.washington.edu/jonno/SISMIDmaterial/wacounty.shx",destfile = "wacounty.shx")
wacounty <- rgdal::readOGR(dsn="R-examples",layer="wacounty")
install.packages("rgdal")
wacounty <- rgdal::readOGR(dsn="R-examples",layer="wacounty")
?readOGR
set_thin_PROJ6_warnings(TRUE)
ogrDrivers()
dsn <- system.file("vectors", package = "rgdal")[1]
ogrListLayers(dsn)
ogrInfo(dsn)
ogrInfo(dsn=dsn, layer="cities")
owd <- getwd()
setwd(dsn)
ogrInfo(dsn="cities.shp")
ogrInfo(dsn="cities.shp", layer="cities")
setwd(owd)
ow <- options("warn")$warn
options("warn"=1)
cities <- readOGR(dsn=dsn, layer="cities")
str(slot(cities, "data"))
if (new_proj_and_gdal()) comment(slot(cities, "proj4string"))
cities$POPULATION <- type.convert(as.character(cities$POPULATION),
na.strings="-99", numerals="no.loss")
str(slot(cities, "data"))
cities <- readOGR(dsn=dsn, layer="cities", GDAL1_integer64_policy=TRUE)
library(rgdal)
set_thin_PROJ6_warnings(TRUE)
ogrDrivers()
dsn <- system.file("vectors", package = "rgdal")[1]
ogrListLayers(dsn)
ogrInfo(dsn)
ogrInfo(dsn=dsn, layer="cities")
owd <- getwd()
setwd(dsn)
ogrInfo(dsn="cities.shp")
ogrInfo(dsn="cities.shp", layer="cities")
setwd(owd)
ow <- options("warn")$warn
options("warn"=1)
cities <- readOGR(dsn=dsn, layer="cities")
str(slot(cities, "data"))
if (new_proj_and_gdal()) comment(slot(cities, "proj4string"))
cities$POPULATION <- type.convert(as.character(cities$POPULATION),
na.strings="-99", numerals="no.loss")
str(slot(cities, "data"))
cities <- readOGR(dsn=dsn, layer="cities", GDAL1_integer64_policy=TRUE)
View(cities)
str(slot(cities, "data"))
options("warn"=ow)
summary(cities)
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
install.packages("sqldf")
blogdown:::preview_site(startup = TRUE)
blogdown:::serve_site()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
blogdown:::serve_site()
blogdown::stop_server()
